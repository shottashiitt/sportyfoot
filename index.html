<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./assets/images/logo2.png">
    <link rel="stylesheet" href="./assets/styles/index.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <title>Sportyfoot</title>
</head>
<body>
    <header>
        <img src="./assets/images/logo.png">
    </header>   

    <main>
        <div class="channels">
            <div class="category">
                <a href="./assets/pages/videos.html">
                    <img src="./assets/images/bein.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/bein2.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/bein3.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/canal.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/canal-foot.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/canal360.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/rmc.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/rmc2.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/eurosport.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/eurosport2.png">
                </a>
            </div>

            
            <div class="category">
                <a href="">
                    <img src="./assets/images/dazn.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/dazn2.png">
                </a>
            </div>

            <div class="category">
                <a href="">
                    <img src="./assets/images/dazn3.png">
                </a>
            </div>
        </div>

        <div class="video">
            <video id="video" controls width="640" height="360"></video>
        </div>
    </main>

    <script>
        console.log("Hls.js charg√© ?", typeof Hls !== "undefined");

        var m3uFileUrl = "https://bfmtv-live.m3u8";

        fetch(m3uFileUrl)
            .then(response => response.text())
            .then(data => {
                console.log("Fichier M3U charg√© :", data);

                // üîç Cherche la premi√®re URL .m3u8 dans le fichier .m3u
                var lines = data.split("\n");
                var firstM3U8 = lines.find(line => line.includes(".m3u8"));

                if (firstM3U8) {
                    playStream(firstM3U8.trim()); // Charge le flux vid√©o
                } else {
                    console.error("Aucun lien .m3u8 trouv√© !");
                }
            })
            .catch(error => console.error("Erreur de chargement du fichier M3U :", error));

        function playStream(url) {
            var video = document.getElementById('video');

            if (window.Hls && Hls.isSupported()) { 
                console.log("Lecture via Hls.js :", url);
                var hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                video.play();

                hls.on(Hls.Events.ERROR, function (event, data) {
                    console.error("Erreur HLS:", data);
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                console.log("Lecture native support√©e");
                video.src = url;
                video.play();
            } else {
                console.error("Le navigateur ne supporte pas HLS !");
            }
        }
    </script>
    
</body>
</html>